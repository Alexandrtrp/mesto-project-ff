(()=>{"use strict";var t={576:(t,e,n)=>{t.exports=n.p+"0863e5bc26221680f1e2.svg"}},e={};function n(o){var r=e[o];if(void 0!==r)return r.exports;var c=e[o]={exports:{}};return t[o](c,c.exports,n),c.exports}function o(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",c)}function r(t){t.classList.remove("popup_is-opened"),t.removeEventListener("keydown",c)}function c(t){"Escape"===t.key&&r(document.querySelector(".popup_is-opened"))}function u(t){if(t.target.classList.contains("popup")||t.target.classList.contains("popup__close"))return r(t.currentTarget),!0}n.m=t,n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.p="",n.b=document.baseURI||self.location.href;var a="https://mesto.nomoreparties.co/v1/cohort-magistr-2",i="bc87767e-4fd6-4faf-bbe1-2b50fbc9866d",l="application/json",s=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))};function p(t,e,n,o,r,c,u,a,i,l){var s=n.querySelector(".places__item").cloneNode(!0),p=s.querySelector(".card__image"),d=s.querySelector(".card__title"),f=s.querySelector(".card__delete-button"),_=s.querySelector(".card__like-button"),m=s.querySelector(".card__like-button_likes");return s.id=a,p.src=t,d.textContent=e,m.textContent=c.length,0!==c?c.forEach((function(t){t._id===i&&_.classList.add("card__like-button_is-active")})):m.textContent=0,u!==i&&(f.style="display: none;"),f.addEventListener("click",(function(t){return l(s)})),_.addEventListener("click",o),p.addEventListener("click",(function(n){return r(t,e)})),s}function d(t){var e,n=t.target.closest(".places__item").id;t.target.classList.contains("card__like-button_is-active")?(t.target.classList.remove("card__like-button_is-active"),(e=n,fetch("".concat(a,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:i,"Content-Type":l}}).then((function(t){return s(t)})).then((function(t){return t.likes.length})).catch((function(t){return console.log("Ошибка. Запрос не выполнен: ".concat(t))}))).then((function(e){t.target.closest(".places__item").querySelector(".card__like-button_likes").textContent=e})).catch((function(t){return console.log("Ошибка. Запрос не выполнен: ".concat(t))}))):(t.target.classList.add("card__like-button_is-active"),function(t){return fetch("".concat(a,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:i,"Content-Type":l}}).then((function(t){return s(t)})).then((function(t){return t.likes.length})).catch((function(t){return console.log("Ошибка. Запрос не выполнен: ".concat(t))}))}(n).then((function(e){t.target.closest(".places__item").querySelector(".card__like-button_likes").textContent=e})).catch((function(t){return console.log("Ошибка. Запрос не выполнен: ".concat(t))})))}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}var _={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"};function m(t,e,n){e.validity.patternMismatch||e.validity.typeMismatch?(e.setCustomValidity(e.dataset.errorMessageDefault),function(t){var e,n=["popup__input_type_name","popup__input_type_card-name"];t.validity.patternMismatch&&(e=t.classList,function(t){if(Array.isArray(t))return f(t)}(e)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(t,e){if(t){if("string"==typeof t)return f(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,e):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).some((function(t){return n.includes(t)}))&&t.setCustomValidity(t.dataset.errorMessage)}(e)):e.setCustomValidity(""),e.validity.valid?function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,n)}function y(t,e,n){0!==t.length&&(function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!0,e.classList.add(n)):(e.disabled=!1,e.classList.remove(n)))}function v(t,e){Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(n){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),n.setCustomValidity(""),o.classList.remove(e.errorClass),o.textContent="",y(Array.from(t.querySelectorAll(e.inputSelector)),t.querySelector(e.submitButtonSelector),e.inactiveButtonClass)}))}var h=new URL(n(576),n.b);document.querySelector(".header__logo").src=h;var S,g="",b={},q=document.querySelector("#card-template").content,C=document.querySelector(".profile__edit-button"),L=document.querySelector(".profile__add-button"),k=document.querySelector(".places__list"),E=document.querySelector(".popup_type_edit"),x=document.querySelector(".popup_type_edit .popup__form"),A=document.querySelector(".popup__input_type_name"),T=document.querySelector(".popup__input_type_description"),w=document.querySelector(".profile__title"),z=document.querySelector(".profile__description"),B=document.querySelector(".popup_type_new-card"),M=document.querySelector(".popup__input_type_card-name"),O=document.querySelector(".popup__input_type_url"),P=document.querySelector(".popup_type_new-card .popup__form"),j=document.querySelector(".popup_type_image"),D=document.querySelector(".popup__image"),I=document.querySelector(".popup__caption"),N=document.querySelector(".popup__delete-card"),U=document.querySelector(".popup__delete-card .popup__button"),V=document.querySelector(".profile__image"),J=document.querySelector(".popup__new-avatar"),H=document.querySelector(".popup__input_type_url-avatar"),R=document.querySelector(".popup__new-avatar .popup__form");function $(t,e){o(j),D.src=t,I.textContent=e}function F(t,e){var n=t.target.querySelector(".popup__button");n.textContent="Сохранение...",e&&(n.textContent="Сохранить")}function G(t){o(N),b=t}document.querySelectorAll(".popup").forEach((function(t){t.classList.add("popup_is-animated")})),Promise.all([fetch("".concat(a,"/users/me"),{headers:{authorization:i}}).then((function(t){return s(t)})).catch((function(t){return console.log("Ошибка. Запрос не выполнен: ".concat(t))})),fetch("".concat(a,"/cards"),{headers:{authorization:i}}).then((function(t){return s(t)})).catch((function(t){return console.log("Ошибка. Запрос не выполнен: ".concat(t))}))]).then((function(t){g=t[0]._id,w.textContent=t[0].name,z.textContent=t[0].about,V.setAttribute("style","background-image: url(".concat(t[0].avatar,");")),t[1].forEach((function(t){k.append(p(t.link,t.name,q,d,$,t.likes,t.owner._id,t._id,g,G))}))})).catch((function(t){return console.log("Ошибка. Запрос не выполнен: ".concat(t))})),C.addEventListener("click",(function(t){A.value=w.textContent,T.value=z.textContent,o(E),v(x,_)})),L.addEventListener("click",(function(t){M.value="",O.value="",o(B),v(P,_)})),V.addEventListener("click",(function(t){H.value="",v(R,_),o(J)})),E.addEventListener("click",u),B.addEventListener("click",u),j.addEventListener("click",u),J.addEventListener("click",u),N.addEventListener("click",(function(t){return u(t)})),U.addEventListener("click",(function(t){var e;(e=b.id,fetch("".concat(a,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:i,"Content-Type":l}}).then((function(t){return s(t)})).catch((function(t){return console.log("Ошибка. Запрос не выполнен: ".concat(t))}))).then((function(t){!function(t){t.closest(".places__item").remove()}(b),r(N)})).catch((function(t){return console.log("Ошибка. Запрос не выполнен: ".concat(t))}))})),x.addEventListener("submit",(function(t){var e,n;t.preventDefault(),F(t),(e=A.value,n=T.value,fetch("".concat(a,"/users/me"),{method:"PATCH",headers:{authorization:i,"Content-Type":l},body:JSON.stringify({name:e,about:n})}).then((function(t){return s(t)})).catch((function(t){return console.log("Ошибка. Запрос не выполнен: ".concat(t))}))).then((function(e){w.textContent=A.value,z.textContent=T.value,t.target.reset(),r(E)})).catch((function(t){return console.log("Ошибка. Запрос не выполнен: ".concat(t))})).finally((function(e){return F(t,!0)}))})),P.addEventListener("submit",(function(t){t.preventDefault();var e=M.value,n=O.value;F(t),function(t,e){return fetch("".concat(a,"/cards"),{method:"POST",headers:{authorization:i,"Content-Type":l},body:JSON.stringify({name:t,link:e})}).then((function(t){return s(t)})).then((function(t){return t._id})).catch((function(t){return console.log("Ошибка. Запрос не выполнен: ".concat(t))}))}(e,n).then((function(t){k.prepend(p(n,e,q,d,$,0,g,t,G)),P.reset(),r(E)})).catch((function(t){return console.log("Ошибка. Запрос не выполнен: ".concat(t))})).finally((function(e){return F(t,!0)}))})),R.addEventListener("submit",(function(t){var e;t.preventDefault(),F(t),(e=H.value,fetch("".concat(a,"/users/me/avatar "),{method:"PATCH",headers:{authorization:i,"Content-Type":l},body:JSON.stringify({avatar:e})}).then((function(t){return s(t)})).catch((function(t){return console.log("Ошибка. Запрос не выполнен: ".concat(t))}))).then((function(t){V.style="background-image: url(".concat(H.value,");"),R.reset(),r(J)})).catch((function(t){return console.log("Ошибка. Запрос не выполнен: ".concat(t))})).finally((function(e){return F(t,!0)}))})),S=_,Array.from(document.querySelectorAll(S.formSelector)).forEach((function(t){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);y(n,o,e.inactiveButtonClass),n.forEach((function(r){r.addEventListener("input",(function(){m(t,r,e),y(n,o,e.inactiveButtonClass)}))}))}(t,S)}))})();